tags:
  - name: Events
    description: Gestion des événements (courses, compétitions)

paths:
  /events:
    get:
      tags: [Events]
      summary: Liste des événements
      responses:
        200:
          description: Liste des événements renvoyée

    post:
      tags: [Events]
      summary: Créer un événement
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, location, start_date, end_date]
              properties:
                name: { type: string }
                location: { type: string }
                start_date: { type: string, format: date-time }
                end_date: { type: string, format: date-time }
                race_type: { type: string }
                website_url: { type: string, format: uri }
                image_url: { type: string, format: uri }
                organiser_name: { type: string }
                organiser_code: { type: string }
                is_visible: { type: boolean }
                is_finished: { type: boolean }
                progression_template_id: { type: string }
      responses:
        201:
          description: Événement créé
        400:
          description: Données invalides

  /events/{id}:
    get:
      tags: [Events]
      summary: Obtenir un événement par ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Détail de l’événement
        404:
          description: Événement non trouvé

    put:
      tags: [Events]
      summary: Modifier un événement
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                location: { type: string }
                start_date: { type: string, format: date-time }
                end_date: { type: string, format: date-time }
                race_type: { type: string }
                website_url: { type: string, format: uri }
                image_url: { type: string, format: uri }
                organiser_name: { type: string }
                organiser_code: { type: string }
                is_visible: { type: boolean }
                is_finished: { type: boolean }
                progression_template_id: { type: string }
      responses:
        200:
          description: Événement mis à jour
        400:
          description: Données invalides
        404:
          description: Événement non trouvé

    delete:
      tags: [Events]
      summary: Supprimer un événement
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Événement supprimé
        404:
          description: Événement non trouvé

  /events/{id}/results-by-category:
    get:
      tags: [Events]
      summary: Obtenir les résultats d'un événement groupés par catégorie
      description: |
        Récupère tous les résultats d'un événement, groupés et triés par catégorie.
        Les résultats sont automatiquement triés par temps (du plus rapide au plus lent) 
        et les positions sont calculées pour chaque catégorie.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: ID de l'événement
      responses:
        200:
          description: Résultats groupés par catégorie
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        category:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            code:
                              type: string
                              nullable: true
                              example: "M23"
                            label:
                              type: string
                              nullable: true
                              example: "Hommes 23 ans"
                            age_group:
                              type: string
                              nullable: true
                            gender:
                              type: string
                              nullable: true
                              enum: [Homme, Femme, Mixte]
                        results:
                          type: array
                          items:
                            type: object
                            properties:
                              race_id:
                                type: string
                                format: uuid
                              race_number:
                                type: integer
                              phase_id:
                                type: string
                                format: uuid
                              phase_name:
                                type: string
                              crew_id:
                                type: string
                                format: uuid
                              lane:
                                type: integer
                              club_name:
                                type: string
                                nullable: true
                              club_code:
                                type: string
                                nullable: true
                              position:
                                type: integer
                                nullable: true
                                description: Position dans le classement de la catégorie (1, 2, 3, ... ou null si pas de timing)
                              finish_time:
                                type: string
                                format: date-time
                                nullable: true
                                description: Timestamp ISO de l'arrivée
                              final_time:
                                type: string
                                nullable: true
                                description: Temps en millisecondes (string)
                                example: "420000"
                              time_seconds:
                                type: string
                                nullable: true
                                description: Temps en secondes avec décimales (string)
                                example: "420.000"
                              time_formatted:
                                type: string
                                nullable: true
                                description: Temps formaté lisible
                                example: "7:00.000"
                              has_timing:
                                type: boolean
                                description: Indique si l'équipage a un temps enregistré
              example:
                status: success
                data:
                  - category:
                      id: "cat-uuid-1"
                      code: "M23"
                      label: "Hommes 23 ans"
                      age_group: "23"
                      gender: "Homme"
                    results:
                      - race_id: "race-uuid-1"
                        race_number: 1
                        phase_id: "phase-uuid-1"
                        phase_name: "Série A"
                        crew_id: "crew-uuid-1"
                        lane: 1
                        club_name: "Club Aviron Paris"
                        club_code: "PAR"
                        position: 1
                        finish_time: "2025-01-15T10:30:45.000Z"
                        final_time: "420000"
                        time_seconds: "420.000"
                        time_formatted: "7:00.000"
                        has_timing: true
                      - race_id: "race-uuid-2"
                        race_number: 2
                        phase_id: "phase-uuid-1"
                        phase_name: "Série A"
                        crew_id: "crew-uuid-2"
                        lane: 2
                        club_name: "Club Aviron Lyon"
                        club_code: "LYO"
                        position: 2
                        finish_time: "2025-01-15T10:31:12.000Z"
                        final_time: "447000"
                        time_seconds: "447.000"
                        time_formatted: "7:27.000"
                        has_timing: true
        404:
          description: Événement non trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Événement non trouvé"
        500:
          description: Erreur serveur
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Erreur lors de la récupération des résultats"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
