tags:
  - name: Import
    description: Importer une manifestation complète depuis l'API fédérale
  - name: Exports
    description: Génération et téléchargement de documents PDF (start list, pesée, etc.)

paths:
  /import/manifestation/{id}:
    post:
      tags: [Import]
      summary: Importer un événement avec ses épreuves, participants et bateaux
      description: |
        Crée un nouvel événement complet avec toutes les catégories, équipages et participants
        depuis l'API FFAviron. Cette route crée un nouvel événement.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID de la manifestation dans l'API source
      responses:
        201:
          description: Importation réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      event_id:
                        type: string
                      name:
                        type: string

  /import/manifestation/{id}/update:
    post:
      tags: [Import]
      summary: Mettre à jour un événement existant depuis l'API FFAviron
      description: |
        Met à jour un événement existant en ajoutant uniquement les nouveaux éléments
        (catégories, participants, équipages) sans toucher à l'existant.
        Cette route ne supprime rien et ne duplique pas les données existantes.
        Les courses, phases et autres données déjà créées ne sont pas affectées.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID de la manifestation dans l'API source
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [event_id]
              properties:
                event_id:
                  type: string
                  format: uuid
                  description: ID de l'événement à mettre à jour
      responses:
        200:
          description: Événement mis à jour avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Événement mis à jour avec succès"
                  data:
                    type: object
                    properties:
                      event_id:
                        type: string
                        format: uuid
                      name:
                        type: string
                      new_categories_count:
                        type: integer
                        description: Nombre de nouvelles catégories créées
                      new_crews_count:
                        type: integer
                        description: Nombre de nouveaux équipages créés
                      new_participants_count:
                        type: integer
                        description: Nombre de nouveaux participants créés
                      total_participants_count:
                        type: integer
                        description: Nombre total de participants liés aux nouveaux équipages
                      new_distances_count:
                        type: integer
                        description: Nombre de nouvelles distances créées
                      new_categories:
                        type: array
                        description: Détails complets des nouvelles catégories créées
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            code:
                              type: string
                            label:
                              type: string
                            age_group:
                              type: string
                              nullable: true
                            gender:
                              type: string
                            boat_seats:
                              type: integer
                              nullable: true
                            has_coxswain:
                              type: boolean
                            distance_id:
                              type: string
                              format: uuid
                              nullable: true
                      new_distances:
                        type: array
                        description: Détails complets des nouvelles distances créées
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            meters:
                              type: integer
                            is_relay:
                              type: boolean
                            relay_count:
                              type: integer
                              nullable: true
                            label:
                              type: string
                      new_crews:
                        type: array
                        description: Détails complets des nouveaux équipages créés
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            category_id:
                              type: string
                              format: uuid
                            category_code:
                              type: string
                            category_label:
                              type: string
                            club_name:
                              type: string
                            club_code:
                              type: string
                            status:
                              type: integer
                      new_participants:
                        type: array
                        description: Détails complets des nouveaux participants créés
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            first_name:
                              type: string
                            last_name:
                              type: string
                            license_number:
                              type: string
                              nullable: true
                            gender:
                              type: string
                            club_name:
                              type: string
                            crew_id:
                              type: string
                              format: uuid
                            crew_club:
                              type: string
                            is_coxswain:
                              type: boolean
                            seat_position:
                              type: integer
                              nullable: true
        400:
          description: Paramètres invalides (event_id manquant)
        404:
          description: Événement introuvable
        500:
          description: Erreur lors de la mise à jour

  /exports/startlist/phase/{phase_id}:
    get:
      tags: [Exports]
      summary: Exporter la start list d'une phase au format PDF
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: phase_id
          required: true
          schema:
            type: string
          description: ID de la phase
      produces:
        - application/pdf
      responses:
        200:
          description: Fichier PDF de la start list
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        404:
          description: Phase non trouvée

  /exports/weighin/phase/{phase_id}:
    get:
      tags: [Exports]
      summary: Exporter la liste de pesée d'une phase au format PDF
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: phase_id
          required: true
          schema:
            type: string
          description: ID de la phase
      produces:
        - application/pdf
      responses:
        200:
          description: Fichier PDF de la pesée
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        404:
          description: Phase non trouvée

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
